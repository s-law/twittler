<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Roboto">
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <header>
      <!-- wordmark etc. go here -->
    </header>
    <main>
      <aside>
        <div id="settings">
          <button id="toggleRefresh">Auto-refresh: OFF</button>
        </div>
        <div id="toTop"></div>
      </aside>
      <section id="content">
        <button id="refreshDidits">Click here to refresh your didit stream</button>
        <div id="didits"></div>
      </section>
      <section id="sidebar">
        <div class="watches" id="watched"></div>
        <div class="watches" id="watching"></div>
        <div id="hashtags"></div>
      </section>
    </main>
    <footer>
      <div id="copyright"></div>
    </footer>
    <script>

      $(document).ready(function(){
        // function changed to reflect new structure 
        var $didits = $('#didits');
        var $toggleRefresh = $('#toggleRefresh');

        var autorefresh = false;
        var diditAutoRefresh;

        function loadDidits() {
          $didits.html('');
          var index = streams.home.length - 1;
          while(index >= 0){
            var tweet = streams.home[index];
            var tweTime = tweet.created_at;
            var tweetElement = '<div class="didit" title="' + tweTime + '\"></div>'
            var tweetFormatted = tweet.message + '<br />' + '@' + tweet.user + ' didit ' + $.timeago(tweTime);

            var $tweet = $(tweetElement);
            $tweet.html(tweetFormatted);
            $tweet.appendTo($didits);
            index -= 1;
          }
        }

        loadDidits();

        $toggleRefresh.on('click', function() {
          $('#refreshDidits').slideToggle();
          if (!autorefresh) {
            autorefresh = true;
            $toggleRefresh.text('Auto-refresh: ON');
            diditAutoRefresh = setInterval(loadDidits, 30000);
          }
          else {
            autorefresh = false;
            $toggleRefresh.text('Auto-refresh: OFF');
            clearInterval(diditAutoRefresh);
          }
        })

        $('#refreshDidits').on('click', function() {
          loadDidits();
        })

      });

    </script>
  </body>
</html>
